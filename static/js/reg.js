var domain="https://ry-api.saobby.com/comment";function reg(){var e=document.getElementById("username").value,t=document.getElementById("password").value,n=document.getElementById("password2").value;""==e|""==t|""==n?document.getElementById("result").innerHTML="用户名和密码均不能为空!":t==n?(get_captcha_img(),document.getElementById("captcha-window").hidden=!1):document.getElementById("result").innerHTML="两次密码输入不一致!"}function complete_captcha(){document.getElementById("reg-btn").disabled=!0,document.getElementById("reg-btn").innerHTML="请稍候";var e=document.getElementById("username").value,t=document.getElementById("password").value,n=document.getElementById("captcha-token").value,a=new XMLHttpRequest;a.open("POST",domain+"/api/register",!0),a.setRequestHeader("Content-Type","application/json");var o={username:e,password:t,captcha_token:n};a.send(JSON.stringify(o)),a.onreadystatechange=function(){if(4===a.readyState){var e=JSON.parse(a.responseText);e.success?(localStorage.setItem("access-token",e.data.access_token),void 0===localStorage.login_redirect?window.location="/":(window.location=localStorage.login_redirect,delete localStorage.login_redirect)):(document.getElementById("reg-btn").disabled=!1,document.getElementById("reg-btn").innerHTML="注册",document.getElementById("result").innerHTML=e.message)}}}
