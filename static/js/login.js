var domain="https://ry-api.saobby.com/comment";function login(){""==document.getElementById("username").value|""==document.getElementById("password").value?document.getElementById("result").innerHTML="用户名和密码均不能为空!":(get_captcha_img(),document.getElementById("captcha-window").hidden=!1)}function complete_captcha(){document.getElementById("login-btn").disabled=!0,document.getElementById("login-btn").innerHTML="请稍候";var e=document.getElementById("username").value,t=document.getElementById("password").value,n=document.getElementById("captcha-token").value,o=new XMLHttpRequest;o.open("POST",domain+"/api/login",!0),o.setRequestHeader("Content-Type","application/json");var a={username:e,password:t,captcha_token:n};o.send(JSON.stringify(a)),o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.responseText);e.success?(localStorage.setItem("access-token",e.data.access_token),void 0===localStorage.login_redirect?window.location="/":(window.location=localStorage.login_redirect,delete localStorage.login_redirect)):(document.getElementById("login-btn").disabled=!1,document.getElementById("login-btn").innerHTML="登录",document.getElementById("result").innerHTML=e.message)}}}
