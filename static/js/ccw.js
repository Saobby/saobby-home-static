"use strict";var domain="https://ccw.saobby.com",ticket="",status="waiting";function show_error_msg(e){gebi("error-msg").innerHTML=e,gebi("notice-div").hidden=!0,gebi("result-div").hidden=!0,gebi("progress-div").hidden=!0,gebi("error-div").hidden=!1,set_btn_html(gebi("query-btn"))}function query(){var e=gebi("project-link").value;e?(set_btn_html(gebi("query-btn"),"..."),saobbyCaptchaV2.open_window_and_return_promise().then((function(t){var s={url:e,captcha_token:t.captcha_token};fetch_data(domain+"/api/get_ticket","POST",headers,JSON.stringify(s)).then((function(e){var t=JSON.parse(e.response_text);if(t.success)if(ticket=t.data.ticket,0===t.data.ret_type){var s=[];for(var n in t.data.releases){var i=t.data.releases[n];s.push("<b>".concat(i.ver?i.ver:"V"+i.sys_ver," </b><br><b>发布时间: </b><span>").concat(ts2str(i.ts/1e3),'</span><br><button type="button" class="wux-btn wux-btn-primary wux-btn-sm" onclick="select_release(this, ').concat(n,');">').concat(icon_with_text("download-white","下载"),'</button> <span id="select-result-').concat(n,'" class="result"></span>'))}gebi("versions-div").innerHTML=s.join("<hr>"),set_btn_html(gebi("query-btn")),gebi("notice-div").hidden=!0,gebi("progress-div").hidden=!0,gebi("result-div").hidden=!1,gebi("error-div").hidden=!0}else status_processing();else show_error_msg(t.message)}),(function(e){show_error_msg(e.message)}))}),(function(e){show_error_msg("请先完成人机验证:"+e.message)}))):show_error_msg("作品链接不能为空")}function status_processing(){status="processing",gebi("process").innerHTML="",gebi("notice-div").hidden=!0,gebi("progress-div").hidden=!1,gebi("result-div").hidden=!0,gebi("error-div").hidden=!0,gebi("query-btn").disabled=!0}function select_release(e,t){set_btn_html(e,"请稍候");var s={ticket:ticket,index:t};fetch_data(domain+"/api/select_release","POST",headers,JSON.stringify(s)).then((function(s){var n=JSON.parse(s.response_text);n.success?status_processing():(gebi("select-result-".concat(t)).innerHTML=n.message,set_btn_html(e))}),(function(s){gebi("select-result-".concat(t)).innerHTML=s.message,set_btn_html(e)}))}setInterval((function(){"processing"===status&&fetch_data(domain+"/api/query_progress","POST",headers,JSON.stringify({ticket:ticket})).then((function(e){var t=JSON.parse(e.response_text);t.success?(gebi("process").innerHTML=t.data.status,t.data.artifact_url&&(gebi("process").innerHTML=gebi("process").innerHTML+' <a href="'.concat(t.data.artifact_url,'" target="_blank"><button type="button" class="wux-btn wux-btn-primary wux-btn-sm">').concat(icon_with_text("download-white","下载"),"</button></a>"),status="waiting",gebi("query-btn").disabled=!1)):gebi("process").innerHTML="无法获取进度信息: "+t.message}),(function(e){gebi("process").innerHTML="无法获取进度信息: "+e.message}))}),1500);