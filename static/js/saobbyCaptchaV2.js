"use strict";var saobbyCaptchaV2=function(e){a("scpc-v2").innerHTML='<link rel="stylesheet" type="text/css" href="https://www.saobby.com/static/css/saobbyCaptchaV2.css"><div id="scpc-trigger" hidden><div class="scpc-pre-like" style="width:fit-content;" onclick="saobbyCaptchaV2.trigger_clicked();" id="scpc-trigger-div"><span id="scpc-trigger-text">⚪点击此处进行人机验证</span></div></div><div style="position:fixed;top:calc( 50vh - 152px );left:calc( 50vw - 152px );width:276px;height:285px;background:#ffffff;" id="scpc-window" class="scpc-pre-like" hidden><div id="scpc-challenge-area" hidden><span style="font-size:15px;top:5px;left:5px;" class="scpc-element"><span>请<b class="scpc-result">依次</b>点击</span></span><img style="top:0px;left:85px;" src="" height="30px" id="scpc-tip-image" class="scpc-element" draggable="false"><span style="font-size:15px;top:5px;left:215px;" class="scpc-element"><span style="color:#555555;">已点击:<span id="scpc-clicked-count">0</span>/<span id="scpc-total">-</span></span></span><button style="font-size:14px;top:271px;left:111px;height:25px;" onclick="document.dispatchEvent(saobbyCaptchaV2.cancelled_event);saobbyCaptchaV2.close_window();" type="button" class="scpc-element" id="scpc-close-window-btn">关闭</button><button style="font-size:14px;top:271px;left:163px;height:25px;" onclick="saobbyCaptchaV2.refresh();" type="button" id="scpc-refresh-btn" class="scpc-element" disabled>换一个</button><img src="" width="300px" height="225px" style="top:40px;left:0px;border-radius:12px;" id="scpc-challenge-image" class="scpc-element" draggable="false" hidden><div id="scpc-refreshing-tips" style="top:40px;left:0px;height:225px;width:300px;" class="scpc-element"><span style="font-size:15px;top:100px;left:120px;" class="scpc-element">请稍候...</span><br><span style="font-size:15px;top:120px;left:100px;" class="scpc-element">正在生成验证码...</span><br></div><button style="font-size:14px;top:271px;left:228px;height:25px;width:70px;" id="scpc-submit-btn" onclick="saobbyCaptchaV2.submit();" type="button" class="scpc-element" disabled>确认</button><span id="scpc-result" style="font-size:15px;top:271px;left:5px;" class="scpc-element scpc-result"></span><img src="https://www.saobby.com/static/image/captcha/1.svg" id="scpc-number-1" class="scpc-numbers scpc-element" number="1" hidden><img src="https://www.saobby.com/static/image/captcha/2.svg" id="scpc-number-2" class="scpc-numbers scpc-element" number="2" hidden><img src="https://www.saobby.com/static/image/captcha/3.svg" id="scpc-number-3" class="scpc-numbers scpc-element" number="3" hidden><img src="https://www.saobby.com/static/image/captcha/4.svg" id="scpc-number-4" class="scpc-numbers scpc-element" number="4" hidden><img src="https://www.saobby.com/static/image/captcha/5.svg" id="scpc-number-5" class="scpc-numbers scpc-element" number="5" hidden><input id="scpc-challenge-id" type="hidden" disabled><input id="scpc-clicked-positions" type="hidden" disabled></div><div id="scpc-loading-area"><span style="font-size:15px;top:130px;left:120px;" class="scpc-element">请稍候...</span><br><span style="font-size:15px;top:150px;left:80px;" class="scpc-element">正在尝试进行人机验证...</span><br><span style="font-size:15px;top:170px;left:100px;" class="scpc-element scpc-result" id="scpc-loading-result"></span></div></div><input id="scpc-token" type="hidden" name="saobby-captcha-token">',"true"===a("scpc-v2").getAttribute("show-trigger")&&(a("scpc-trigger").hidden=!1);var c={},s={"Content-Type":"application/json"},t=new CustomEvent("scpc_challenge_resolved",{detail:{}}),n=new CustomEvent("scpc_challenge_cancelled",{detail:{}});a("scpc-challenge-image").addEventListener("click",(function(e){var c=parseInt(a("scpc-clicked-count").innerHTML),s=parseInt(a("scpc-total").innerHTML);if(c<s){var t=e.offsetX,n=e.offsetY,i=JSON.parse(a("scpc-clicked-positions").value);i.push([t,n]),a("scpc-clicked-positions").value=JSON.stringify(i),c+=1,a("scpc-clicked-count").innerHTML=c.toString(),a("scpc-number-"+c).hidden=!1,a("scpc-number-"+c).style="left:".concat(t-15,"px;top:").concat(n+40-15,"px;"),c===s&&(a("scpc-submit-btn").disabled=!1)}}));for(var i=d("scpc-numbers"),p=0;p<i.length;p++){i[p].setAttribute("onclick",'saobbyCaptchaV2.remove_choice(parseInt(this.getAttribute("number")));')}function a(e){return document.getElementById(e)}function d(e){return document.getElementsByClassName(e)}function l(e,c,s,t){return new Promise((function(n,i){var p=new XMLHttpRequest;for(var a in p.open(c,e,!0),s)p.setRequestHeader(a,s[a]);try{"GET"===c?p.send():p.send(t)}catch(e){i({message:e.name+e.message})}p.onreadystatechange=function(){4===p.readyState&&(0===p.status?i({message:"网络错误"}):n({response_text:p.responseText,status_code:p.status}))},p.onerror=function(){i({message:"网络错误"})}}))}function r(){return new Promise((function(c,t){l(e+"/api/gen_challenge","POST",s,JSON.stringify({})).then((function(e){var s=JSON.parse(e.response_text);s.success?c(s):t(s)}),(function(e){t({success:!1,message:e.message,data:null})}))}))}function o(){a("scpc-clicked-count").innerHTML="0",a("scpc-clicked-positions").value=JSON.stringify([]);for(var e=d("scpc-numbers"),c=0;c<e.length;c++){var s=e[c];s.hidden=!0,s.style=""}}return c.open_window_and_return_promise=function(){return new Promise((function(e,s){document.addEventListener("scpc_challenge_resolved",(function(c){e({message:"用户完成了验证码",captcha_token:a("scpc-token").value})})),document.addEventListener("scpc_challenge_cancelled",(function(e){s({message:"用户关闭了验证码窗口"})})),a("scpc-window").hidden?(a("scpc-window").hidden=!1,a("scpc-challenge-area").hidden=!0,a("scpc-loading-area").hidden=!1,a("scpc-refresh-btn").disabled=!0,a("scpc-submit-btn").disabled=!0,o(),a("scpc-loading-result").innerHTML="",a("scpc-result").innerHTML="",r().then((function(s){1===s.data.return_type?(a("scpc-token").value=s.data.option.token,c.close_window(),e({message:"用户直接通过了验证",captcha_token:s.data.option.token})):0===s.data.return_type&&(a("scpc-challenge-id").value=s.data.option.challenge_id,a("scpc-total").innerHTML=s.data.option.word_length,a("scpc-tip-image").src=s.data.option.tip_image,a("scpc-challenge-image").src=s.data.option.captcha_image,a("scpc-challenge-area").hidden=!1,a("scpc-challenge-image").hidden=!1,a("scpc-refreshing-tips").hidden=!0,a("scpc-loading-area").hidden=!0,a("scpc-refresh-btn").disabled=!1)}),(function(e){a("scpc-loading-result").innerHTML=e.message,s({message:"无法加载验证码:"+e.message})}))):s({message:"有一个正在进行的人机验证，请先完成或取消当前的人机验证"})}))},c.close_window=function(){a("scpc-window").hidden=!0},c.resolved_event=t,c.cancelled_event=n,c.remove_choice=function(e){a("scpc-submit-btn").disabled=!0;for(var c=parseInt(a("scpc-total").innerHTML),s=JSON.parse(a("scpc-clicked-positions").value),t=e;t<=c;t++)a("scpc-number-"+t).hidden||s.pop(),a("scpc-number-"+t).hidden=!0,a("scpc-number-"+t).style="";a("scpc-clicked-count").innerHTML=(e-1).toString(),a("scpc-clicked-positions").value=JSON.stringify(s)},c.refresh=function(){a("scpc-submit-btn").disabled=!0,o(),a("scpc-challenge-image").hidden=!0,a("scpc-refreshing-tips").hidden=!1,a("scpc-refresh-btn").disabled=!0,a("scpc-refresh-btn").innerHTML="加载中",r().then((function(e){a("scpc-challenge-image").hidden=!1,a("scpc-refreshing-tips").hidden=!0,a("scpc-refresh-btn").disabled=!1,a("scpc-refresh-btn").innerHTML="换一个",a("scpc-challenge-id").value=e.data.option.challenge_id,a("scpc-total").innerHTML=e.data.option.word_length,a("scpc-tip-image").src=e.data.option.tip_image,a("scpc-challenge-image").src=e.data.option.captcha_image,a("scpc-result").innerHTML=""}),(function(e){a("scpc-refresh-btn").disabled=!1,a("scpc-refresh-btn").innerHTML="换一个",a("scpc-result").innerHTML=e.message}))},c.submit=function(){a("scpc-submit-btn").disabled=!0,a("scpc-refresh-btn").disabled=!0,a("scpc-close-window-btn").disabled=!0,a("scpc-submit-btn").innerHTML="验证中";var n=a("scpc-challenge-id").value,i=JSON.parse(a("scpc-clicked-positions").value);l(e+"/api/get_token","POST",s,JSON.stringify({challenge_id:n,positions:i})).then((function(e){var s=JSON.parse(e.response_text);a("scpc-submit-btn").disabled=!1,a("scpc-refresh-btn").disabled=!1,a("scpc-close-window-btn").disabled=!1,a("scpc-submit-btn").innerHTML="确认",s.success?(a("scpc-token").value=s.data.token,document.dispatchEvent(t),c.close_window()):(a("scpc-result").innerHTML=s.message,c.refresh())}),(function(e){a("scpc-result").innerHTML=e.message,a("scpc-submit-btn").disabled=!1,a("scpc-refresh-btn").disabled=!1,a("scpc-close-window-btn").disabled=!1,a("scpc-submit-btn").innerHTML="确认",c.refresh()}))},c.trigger_clicked=function(){a("scpc-trigger-div").setAttribute("onclick",""),a("scpc-trigger-text").innerHTML="⚫正在进行人机验证",c.open_window_and_return_promise().then((function(e){a("scpc-trigger-text").innerHTML="✔成功通过人机验证"}),(function(e){a("scpc-trigger-text").innerHTML="⚪点击此处进行人机验证",a("scpc-trigger-div").setAttribute("onclick","saobbyCaptchaV2.trigger_clicked();")}))},c}("https://captcha-v2.saobby.com");