function upload_avatar(){void 0!==document.getElementById("avatar_img_file").files[0]?(get_captcha_img(),document.getElementById("captcha-window").hidden=!1):document.getElementById("upload_result").innerHTML="你未选择任何文件"}function set_avatar(){if(""!=(e=document.getElementById("avatar_url").value)){document.getElementById("save-btn").disabled=!0,document.getElementById("save-btn").innerHTML="请稍候";var e=document.getElementById("avatar_url").value,t=new XMLHttpRequest;t.open("POST","https://fast-comment.saobby.com/api/set_avatar_url",!0),t.setRequestHeader("Content-Type","application/json");var n={avatar_url:e,access_token:localStorage.getItem("access-token")};t.send(JSON.stringify(n)),t.onreadystatechange=function(){4==t.readyState&&(ret_json=JSON.parse(t.responseText),ret_json.success?window.location="/":(document.getElementById("save-btn").disabled=!1,document.getElementById("save-btn").innerHTML="保存",document.getElementById("set_result").innerHTML=ret_json.message))}}else document.getElementById("set_result").innerHTML="头像链接不能为空!"}function complete_captcha(){document.getElementById("upload-btn").innerHTML="上传中",document.getElementById("upload-btn").disabled=!0;var e=document.getElementById("avatar_img_file").files[0],t=document.getElementById("captcha-token").value,n=new FormData,a=new XMLHttpRequest;a.open("post","https://saobbyggusercontent.pythonanywhere.com/api/upload_image",!0),a.onreadystatechange=function(){4==this.readyState&&(ret_json=JSON.parse(this.responseText),ret_json.success&&(document.getElementById("avatar_url").value=ret_json.data.image_url,document.getElementById("avatar_img").src=ret_json.data.image_url),document.getElementById("upload_result").innerHTML=ret_json.message,document.getElementById("upload-btn").innerHTML="上传",document.getElementById("upload-btn").disabled=!1)},a.upload.onprogress=function(e){if(e.lengthComputable){var t=100*e.loaded/e.total;document.getElementById("upload_result").innerHTML=100==t?"正在处理...":"上传中("+Math.floor(t)+"%)"}},n.append("image",e),n.append("captcha_token",t),a.send(n)}null==localStorage.getItem("access-token")&&(localStorage.login_redirect=window.location.href,window.location="/login");