"use strict";var domain="https://comments.saobby.com";function upload_avatar(){var e=gebi("avatar_img_file").files[0];void 0!==e?(set_btn_html(gebi("upload-btn"),"请完成人机验证"),gebi("avatar_img_file").disabled=!0,saobbyCaptchaV2.open_window_and_return_promise().then((function(a){set_btn_html(gebi("upload-btn"),"正在上传");var t=new FormData,n=new XMLHttpRequest;n.open("post","https://upload-static.saobby.com/api/upload_image",!0),n.onreadystatechange=function(){if(4===this.readyState){var e=JSON.parse(this.responseText);e.success?(gebi("upload_result").innerHTML="上传成功",gebi("avatar_url").value=e.data.image_url,gebi("avatar_img").src=e.data.image_url):gebi("upload_result").innerHTML=e.message,set_btn_html(gebi("upload-btn")),gebi("avatar_img_file").disabled=!1}},n.upload.onprogress=function(e){if(e.lengthComputable){var a=100*e.loaded/e.total;100===a?(gebi("upload_result").innerHTML="正在处理...",gebi("upload-progress").hidden=!0):(gebi("upload_result").innerHTML="上传中("+Math.floor(a)+"%)",gebi("upload-progress").value=a,gebi("upload-progress").hidden=!1)}},t.append("image",e),t.append("captcha_token",a.captcha_token),n.send(t)}),(function(e){gebi("upload_result").innerHTML="请先完成人机验证:"+e.message,gebi("avatar_img_file").disabled=!1,set_btn_html(gebi("upload-btn"))}))):gebi("upload_result").innerHTML="你未选择任何文件"}function set_avatar(){var e,a;""!=(a=gebi("avatar_url").value)?(set_btn_html(gebi("save-btn"),"请稍候"),a=gebi("avatar_url").value,(e=new XMLHttpRequest).open("POST",domain+"/api/set_avatar_url",!0),e.setRequestHeader("Content-Type","application/json"),a={avatar_url:a,access_token:localStorage.getItem("access-token")},e.send(JSON.stringify(a)),e.onreadystatechange=function(){4==e.readyState&&((ret_json=JSON.parse(e.responseText)).success?window.location="/":(set_btn_html(gebi("save-btn")),gebi("set_result").innerHTML=ret_json.message))}):gebi("set_result").innerHTML="头像链接不能为空!"}null==localStorage.getItem("access-token")&&(localStorage.login_redirect=window.location.href,window.location="/login");